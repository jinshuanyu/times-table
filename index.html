<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ååä¹˜æ³•è¡¨ & ä¹˜æ³•å¤§æŒ‘æˆ°ï½œHTML5</title>

<!-- Tone.js (for sound effects) -->
<script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>

<style>
  :root{
    /* åŸºæœ¬è‰²ï¼ˆç§»é™¤æ‰€æœ‰æ¼¸å±¤ï¼‰ */
    --bg:#f7f8fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280; --line:#e5e7eb;

    --blue-50:#eff6ff; --blue-100:#dbeafe; --blue-200:#bfdbfe; --blue-800:#1e40af;
    --yellow-100:#fef3c7; --yellow-300:#fcd34d; --yellow-800:#92400e;

    --purple-200:#e9d5ff; --purple-300:#d8b4fe; --purple-500:#7c3aed;
    --green-200:#bbf7d0; --green-300:#86efac; --green-500:#22c55e;

    --indigo-300:#a5b4fc; --indigo-400:#818cf8; --indigo-800:#3730a3; --indigo-900:#312e81;
    --orange-200:#fed7aa; --orange-300:#fdba74; --orange-500:#f97316;
    --red-500:#ef4444; --teal-50:#f0fdfa; --teal-600:#0d9488;
  }

  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial;
  }

  .wrap{
    min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;
    padding:16px;
  }

  /* Top nav (å…©é¡† pill) */
  nav{
    margin-bottom:20px; padding:12px 16px; background:var(--card);
    border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.06);
    display:flex; flex-wrap:wrap; justify-content:center; gap:12px;
  }
  .pill{
    border:0; cursor:pointer; padding:10px 18px; border-radius:999px; font-weight:800; font-size:18px;
    transition:transform .15s ease, background-color .15s ease, box-shadow .15s ease, color .15s ease;
  }
  .pill:hover{ transform:scale(1.05) }
  .pill-purple{ background:var(--purple-200); color:#5b21b6 }
  .pill-purple.active{ background:var(--purple-500); color:#fff; box-shadow:0 6px 16px rgba(124,58,237,.28) }
  .pill-purple:hover{ background:var(--purple-300) }
  .pill-green{ background:var(--green-200); color:#065f46 }
  .pill-green.active{ background:var(--green-500); color:#fff; box-shadow:0 6px 16px rgba(34,197,94,.28) }
  .pill-green:hover{ background:var(--green-300) }

  /* å…§å®¹å€ */
  main{ width:100%; max-width:760px; padding:8px } /* æ¡Œæ©Ÿæ”¶çª„ */
  section.card{ background:transparent }

  h1.title{
    font-size:clamp(28px,4vw,44px); margin:0 0 16px; font-weight:900; text-align:center; color:#2563eb;
  }
  /* ç§»é™¤å­¸ç¿’é çš„èªªæ˜æ–‡å­— */
  #learningPage .subtitle{ display:none !important; }

  /* ========== Learningï¼ˆ10Ã—10 ä¹˜æ³•è¡¨ï¼‰ ========== */
  .table-wrap{ overflow-x:auto }
  table.mul{
    width:100%;
    border:1px solid var(--blue-200);
    border-collapse:collapse;                  /* ç·Šå¯¦ã€ä¸ç•™ç¸« */
    background:var(--blue-50);
    border-radius:0 !important;                /* ä¸è¦åœ“è§’ */
    box-shadow:0 8px 20px rgba(30,64,175,.06); /* è¼•é™°å½±å³å¯ */
    font-size:clamp(14px,3.8vw,18px);          /* æ‰‹æ©Ÿç¨å¤§ã€ä½†ä¸çˆ† */
    table-layout:fixed;                        /* å¹³å‡åˆ†æ¬„ï¼Œé˜²æ©«æ»‘ */
  }
  .mul th,.mul td{
    padding:7px 6px;
    border-bottom:1px solid var(--blue-200);
    text-align:center; white-space:nowrap;
  }
  .mul thead th{ background:var(--blue-100); color:var(--blue-800); font-weight:800 }
  .mul tbody td:first-child{
    background:#eaf2ff; color:#1d4ed8; font-weight:800; position:sticky; left:0;
  }
  .mul td.hl, .mul th.hl { background:#fff7cc !important }           /* é»ƒè‰²æ·¡äº® */
  .mul td.hl-strong, .mul th.hl-strong{ background:#ffe066 !important }

  /* æ¡Œæ©Ÿï¼šä¹˜æ³•è¡¨å®¹å™¨å†æ”¶çª„ä¸€é»ï¼ˆé¿å…å¤ªæ‰ï¼‰ */
  @media (min-width:1024px){
    #learningPage .table-wrap{
      max-width:700px; margin-left:auto; margin-right:auto;
    }
  }
  /* æ‰‹æ©Ÿï¼šæ›´è²¼é‚Šï¼ˆå¹¾ä¹ç„¡ç•™ç™½ï¼‰ */
  @media (max-width:480px){
    .wrap{ padding-left:12px; padding-right:12px }
    main{ padding:0 }
    #learningPage .table-wrap{ margin-left:-8px; margin-right:-8px; padding:0 2px }
  }

  /* ========== Practiceï¼ˆç·´ç¿’ï¼‰ ========== */
  .center{ text-align:center }
  .score{ font-size:clamp(18px,2.5vw,28px); font-weight:800; color:#065f46; margin-bottom:8px }
  .qcount{ font-size:clamp(16px,2.3vw,24px); color:#475569; margin-bottom:18px }

  .question-box{
    display:inline-block; background:var(--yellow-100); padding:22px;
    border-radius:16px; box-shadow:0 10px 24px rgba(0,0,0,.06);
    margin-bottom:18px;
  }
  .question{ font-size:clamp(38px,6vw,62px); font-weight:900; color:var(--yellow-800); margin:0 }

  .grid{ display:grid; gap:12px; margin:0 auto }
  .grid-choices{ grid-template-columns:repeat(2,minmax(0,1fr)); max-width:520px }
  .grid-multipliers{ grid-template-columns:repeat(5,minmax(0,1fr)); max-width:720px; margin-bottom:18px } /* èˆ‡é–‹å§‹ç·´ç¿’æ‹‰é–‹ */
  #btnStart{ margin-top:10px }

  .btn{
    border:0; cursor:pointer; padding:14px 16px; border-radius:14px; font-weight:900;
    transition:transform .12s ease, box-shadow .15s ease, background-color .12s ease, color .12s ease;
    box-shadow:0 4px 12px rgba(0,0,0,.06); font-size:clamp(18px,3.2vw,28px)
  }
  .btn:hover{ transform:scale(1.04) }

  /* ç­”æ¡ˆé¸é … */
  .btn-choice{ background:var(--indigo-300); color:#111827 }
  .btn-choice:hover{ background:var(--indigo-400) }
  .btn-choice.correct{ background:var(--green-500) !important; color:#fff !important; transform:scale(1.08) }
  .btn-choice.wrong{ background:var(--red-500) !important; color:#fff !important; transform:scale(1.03) }
  .btn-choice.dim{ opacity:.55; cursor:not-allowed }

  /* ä¹˜æ•¸æŒ‰éˆ•ï¼šä¸€èˆ¬æ•¸å­—æ©˜è‰²ï¼›ğŸ² ç¶œåˆç·´ç¿’é¸ä¸­=æ·±ç´«è—ï¼ˆéå¸¸æ˜é¡¯ï¼‰ */
  .btn-multi{ background:var(--orange-200); color:#7c2d12; font-size:clamp(20px,3.5vw,30px) }
  .btn-multi.active{ background:var(--orange-500); color:#fff; box-shadow:0 6px 14px rgba(249,115,22,.28) }
  .btn-multi:hover{ background:var(--orange-300) }
  .btn-multi[data-val="all"].active{
    background:var(--indigo-900) !important; color:#fff !important;
    box-shadow:0 10px 20px rgba(49,46,129,.5) !important;
    border-color:transparent !important;
  }
  .btn-multi[data-val="all"].active:hover{ background:var(--indigo-800) !important }

  .btn-start{
    background:#3b82f6; color:#fff; padding:14px 24px; border-radius:999px; font-weight:900; font-size:clamp(20px,3.8vw,32px);
    box-shadow:0 8px 22px rgba(59,130,246,.28)
  }
  .btn-start:disabled{ background:#cbd5e1; color:#475569; cursor:not-allowed; box-shadow:none }

  .feedback{ font-size:clamp(20px,3.2vw,32px); font-weight:900; margin-top:10px; animation:bounce 1s infinite }
  @keyframes bounce{ 0%,100%{ transform:translateY(0) } 50%{ transform:translateY(-6px) } }

  /* çµæœè¡¨ï¼ˆä¿æŒç´ è‰²ã€ç„¡æ¼¸å±¤ï¼‰ */
  .result-title{
    font-size:clamp(28px,4vw,44px); font-weight:900; color:var(--teal-600);
    text-align:center; margin:0 0 14px;
  }
  .score-badge{
    display:inline-block; font-size:clamp(36px,6vw,56px); font-weight:900; color:var(--teal-600);
    background:var(--teal-50); padding:18px 24px; border-radius:999px; box-shadow:0 8px 20px rgba(13,148,136,.18);
    margin-bottom:16px;
  }

  .review{
    background:var(--card); border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.06);
    padding:12px 14px; overflow-x:auto; margin:0 auto; max-width:800px;
  }
  table.review-table{ width:100%; border-collapse:collapse; min-width:520px; font-size:clamp(14px,2.5vw,18px) }
  .review-table th,.review-table td{ padding:10px 12px; border-bottom:1px solid var(--line); text-align:left }
  .review-table thead th{ background:var(--blue-100); color:var(--blue-800) }
  .review-table tr:hover{ background:#f8fbff }
  .tag-ok{ color:var(--green-500); font-weight:800 }
  .tag-bad{ color:var(--red-500); font-weight:800 }

  .actions{ margin-top:14px; display:flex; flex-direction:column; gap:10px; align-items:center; justify-content:center }
  @media (min-width:720px){ .actions{ flex-direction:row } }

  .btn-secondary{
    background:var(--orange-500); color:#fff; border:0; padding:12px 20px; border-radius:999px; font-weight:900;
    font-size:clamp(18px,3.2vw,28px); transition:transform .12s ease; box-shadow:0 8px 20px rgba(249,115,22,.28)
  }
  .btn-secondary:hover{ transform:scale(1.04) }

  .btn-tertiary{
    background:var(--purple-500); color:#fff; border:0; padding:12px 20px; border-radius:999px; font-weight:900;
    font-size:clamp(18px,3.2vw,28px); transition:transform .12s ease; box-shadow:0 8px 20px rgba(124,58,237,.28)
  }
  .btn-tertiary:hover{ transform:scale(1.04) }

  /* æ‰‹æ©Ÿï¼šå°è¦½å…©é¡†åŒæ’ */
  @media (max-width:480px){
    nav{
      display:grid; grid-template-columns:repeat(2, minmax(0, 1fr));
      gap:8px; justify-content:center;
    }
    .pill{ width:100%; padding:10px 12px; font-size:18px }
  }

  /* ä¿éšªï¼šè‹¥æœ‰ä»»ä½•é é¢åº•éƒ¨ç”¨åˆ°å½å…ƒç´ åšè‰²å¡Šï¼Œå…¨éƒ¨ç§»é™¤ */
  #learningPage::after, #practicePage::after{ content:none !important; }

  /* ç‰ˆæ¬Šå€å¡Š */
  .site-footer{
    text-align:center; color:#6b7280; font-size:14px; padding:16px 12px; margin-top:20px;
  }
  /* è®“ .wrap åƒæ»¿ã€Œå¯¦éš›å¯è¦–é«˜åº¦ã€ï¼Œfooter å¾…åœ¨æœ€åº•ä¸‹ï¼Œä¸æœƒå†æŠŠé é¢æ’é«˜ */
.wrap{
  min-height: 100svh;           /* ç”¨ svh/dvh é¿é–‹ 100vh çš„åœ°å€åˆ—å•é¡Œ */
  display: flex;
  flex-direction: column;
}

/* è®“ footer è²¼åº•ï¼ˆä½†ä»åœ¨ .wrap è£¡ï¼‰ï¼Œä¸æœƒå†å¤šå‡ºå¤šé¤˜é«˜åº¦ */
.site-footer{
  margin-top: auto;
}

/* æ‰‹æ©Ÿä¸Šé¿å…å°å°çš„ scale é€ æˆé«˜åº¦å¤–æº¢ï¼Œç›´æ¥é—œæ‰å°±å¥½ï¼ˆå¯é¸ï¼‰ */
@media (max-width: 480px){
  .question-box{ transform: none; }
}
/* ğŸ“± æ‰‹æ©Ÿï¼š1x~10x æ¯æ’ 3 å€‹ï¼ŒæŒ‰éˆ•æ›´å¯¬æ›´å¥½æŒ‰ */
@media (max-width: 600px){
  /* ä¹˜æ•¸é¸å–®æ”¹ 3 æ¬„ */
  #practicePage .grid-multipliers{
    grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
    gap: 10px !important;
    max-width: 100% !important;
  }

  /* ğŸ² ç¶œåˆç·´ç¿’ ä»å æ»¿ä¸€æ•´åˆ—ï¼Œå’Œä¸‹é¢æ•¸å­—ç•™è·é›¢ */
  #practicePage .grid-multipliers > button[data-val="all"]{
    grid-column: 1 / -1;
    margin-bottom: 14px;
  }

  /* æ•¸å­—æŒ‰éˆ•æ’æ»¿æ ¼å­ã€åŠ å¤§è§¸æ§é¢ç© */
  #practicePage .grid-multipliers > .btn-multi{
    width: 100%;
    min-height: 54px;           /* æ‰‹æŒ‡æ›´å¥½é» */
    padding: 12px 8px;          /* æ©«å‘æ›´é£½æ»¿ */
    font-size: 20px;            /* è¦–è¦ºå†æ¸…æ¥šä¸€é» */
    justify-content: center;    /* æ–‡æ¡ˆç½®ä¸­ä¿éšª */
  }
}
/* æ•´ç«™åº•è‰²ï¼šå¾ˆæ·¡ã€ä½å½©åº¦çš„ç²‰ç´… */
:root{
  --bg: hsl(345 25% 98%);  /* 345Â° ç²‰ç´…ç›¸è¿‘è‰²ï¼Œ25% å½©åº¦ã€98% äº®åº¦ */
}
body{
  background: var(--bg) !important; /* è¦†è“‹ä»»ä½•å…ˆå‰è¨­å®š */
}

</style>

</head>
<body>
<div class="wrap">
  <!-- Top Nav -->
  <nav>
    <button id="btnLearning" class="pill pill-purple active">ğŸ“š å­¸ç¿’ä¹˜æ³•</button>
    <button id="btnPractice" class="pill pill-green">ğŸ“ ç·´ç¿’æŒ‘æˆ°</button>
  </nav>

  <main>
    <!-- Learning Page -->
    <section id="learningPage" class="card">
      <h1 class="title">ååä¹˜æ³•è¡¨ ğŸ’–</h1>
      <div class="table-wrap">
        <table id="mulTable" class="mul" aria-label="10Ã—10 ä¹˜æ³•è¡¨"></table>
      </div>
      <p class="subtitle">é€™å€‹è¡¨æ ¼å¯ä»¥å¹«åŠ©ä½ å¿«é€Ÿå­¸ç¿’ä¹˜æ³•ï¼</p>
    </section>

    <!-- Practice Page -->
    <section id="practicePage" class="card" style="display:none">
      <div id="practiceContainer" class="center"></div>
    </section>
  </main>
  <footer class="site-footer">Â© 2025 Christina Yu</footer>

</div>

<script>
(function(){
  // ----- State -----
  const state = {
    currentPage: 'learning',
    selectedMultiplier: null, // number or 'all'
    currentQuestionIndex: 0,  // 0..9
    currentQuestion: null,    // {factor1, factor2, answer}
    options: [],
    score: 0,
    roundStarted: false,
    showResult: false,
    selectedAnswer: null,
    isCorrect: null,
    history: []
  };

  // ----- Audio via Tone.js -----
  let synth = null;

  async function initializeAudioContext(){
    if (Tone.context.state !== 'running') {
      await Tone.start();
      // create synth after user gesture
      if (!synth) synth = new Tone.Synth().toDestination();
      console.log('AudioContext is initialized and running!');
    } else {
      if (!synth) synth = new Tone.Synth().toDestination();
    }
  }

  const delay = (ms) => new Promise(r => setTimeout(r, ms));

  async function playCorrectSound(){
    if (!synth || Tone.context.state !== 'running') return;
    synth.triggerAttackRelease("C5","8n");
    await delay(100);
    synth.triggerAttackRelease("G5","8n");
    await delay(200);
    synth.triggerAttackRelease("C5","8n");
    await delay(100);
    synth.triggerAttackRelease("G5","8n");
  }
  async function playIncorrectSound(){
    if (!synth || Tone.context.state !== 'running') return;
    synth.triggerAttackRelease("F4","8n");
    await delay(250);
    synth.triggerAttackRelease("C4","8n");
  }

  // ----- Page Switch -----
  const btnLearning = document.getElementById('btnLearning');
  const btnPractice = document.getElementById('btnPractice');
  const learningPage = document.getElementById('learningPage');
  const practicePage = document.getElementById('practicePage');

  btnLearning.addEventListener('click', async () => {
    await initializeAudioContext(); // optional: warm up on nav click
    state.currentPage = 'learning';
    learningPage.style.display = '';
    practicePage.style.display = 'none';
    btnLearning.classList.add('active');
    btnPractice.classList.remove('active');
  });

  btnPractice.addEventListener('click', async () => {
    await initializeAudioContext();
    state.currentPage = 'practice';
    learningPage.style.display = 'none';
    practicePage.style.display = '';
    btnPractice.classList.add('active');
    btnLearning.classList.remove('active');
    renderPracticeSelect();
  });

  // ----- Build Learning Table (10Ã—10) -----
  function buildMulTable(){
    const t = document.getElementById('mulTable');
    t.innerHTML = '';
    const thead = document.createElement('thead');
    const trh = document.createElement('tr');

    const thx = document.createElement('th');
    thx.textContent = 'Ã—';
    trh.appendChild(thx);

    for(let c=1;c<=10;c++){
      const th = document.createElement('th');
      th.textContent = c;
      trh.appendChild(th);
    }
    thead.appendChild(trh);
    t.appendChild(thead);

    const tbody = document.createElement('tbody');

    for(let r=1;r<=10;r++){
      const tr = document.createElement('tr');

      const thRow = document.createElement('td');
      thRow.textContent = r;
      thRow.style.fontWeight = '800';
      tr.appendChild(thRow);

      for(let c=1;c<=10;c++){
        const td = document.createElement('td');
        td.textContent = r*c;

        td.addEventListener('mouseenter', () => highlightRC(r,c));
        td.addEventListener('mouseleave', () => clearHighlight());

        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }
    t.appendChild(tbody);
  }

  function highlightRC(r,c){
    const t = document.getElementById('mulTable');
    clearHighlight();

    // header col
    t.tHead.rows[0].cells[c].classList.add('hl-strong');

    // rows
    for(let ri=0; ri<t.tBodies[0].rows.length; ri++){
      const row = t.tBodies[0].rows[ri];
      const rowIndex = ri+1;

      // row label cell
      if (rowIndex === r) row.cells[0].classList.add('hl-strong'); else row.cells[0].classList.remove('hl-strong');

      for(let ci=1; ci<row.cells.length; ci++){
        const cell = row.cells[ci];
        if (rowIndex === r || ci === c) {
          cell.classList.add('hl');
        }
        if (rowIndex === r && ci === c) {
          cell.classList.remove('hl');
          cell.classList.add('hl-strong');
        }
      }
    }
  }

  function clearHighlight(){
    document.querySelectorAll('#mulTable .hl, #mulTable .hl-strong').forEach(el => el.classList.remove('hl','hl-strong'));
  }

  // ----- Practice Flow -----
  const practiceContainer = document.getElementById('practiceContainer');

  function renderPracticeSelect(){
    state.roundStarted = false;
    state.showResult = false;
    practiceContainer.innerHTML = `
      <h1 class="title" style="color:#16a34a; text-shadow:0 3px 0 rgba(255,255,255,.4); margin-bottom:18px">ä¹˜æ³•å¤§æŒ‘æˆ° ğŸŒŸ</h1>

      <div class="grid grid-multipliers mb-6" id="multiGrid">
        <button class="btn btn-multi" data-val="all" style="grid-column:1/-1; font-size:clamp(22px,4vw,34px); padding:18px 0; border-radius:18px; background:#c7d2fe; color:#1e3a8a; box-shadow:0 8px 22px rgba(30,58,138,.25)">ğŸ² ç¶œåˆç·´ç¿’ (1~10)</button>
        ${Array.from({length:10},(_,i)=>i+1).map(n=>`<button class="btn btn-multi" data-val="${n}">${n}x</button>`).join('')}
      </div>

      <button id="btnStart" class="btn-start" disabled>é–‹å§‹ç·´ç¿’ï¼ğŸš€</button>
    `;

    const g = document.getElementById('multiGrid');
    const startBtn = document.getElementById('btnStart');

    g.addEventListener('click', (e)=>{
      const b = e.target.closest('button[data-val]');
      if (!b) return;
      g.querySelectorAll('button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const val = b.getAttribute('data-val');
      state.selectedMultiplier = (val==='all') ? 'all' : Number(val);
      startBtn.disabled = false;
    });

    startBtn.addEventListener('click', async ()=>{
      await initializeAudioContext();
      startRound();
      renderQuiz();
    });
  }

  function startRound(){
    state.score = 0;
    state.currentQuestionIndex = 0;
    state.roundStarted = true;
    state.showResult = false;
    state.history = [];
    generateQuestion(state.selectedMultiplier);
  }

  function generateQuestion(multiplier){
    let factor1, factor2;
    if (multiplier === 'all'){
      factor1 = Math.floor(Math.random()*10)+1;
      factor2 = Math.floor(Math.random()*10)+1;
    } else {
      factor1 = multiplier;
      factor2 = Math.floor(Math.random()*10)+1;
    }
    const answer = factor1 * factor2;

    const set = new Set([answer]);
    while(set.size < 4){
      const wrong = answer + (Math.floor(Math.random()*20) - 10);
      if (wrong > 0 && wrong !== answer) set.add(wrong);
    }
    const options = Array.from(set).sort(()=>Math.random()-0.5);

    state.currentQuestion = {factor1, factor2, answer};
    state.options = options;
    state.selectedAnswer = null;
    state.isCorrect = null;
  }

  function renderQuiz(){
    const title = (state.selectedMultiplier === 'all') ? 'ç¶œåˆä¹˜æ³•ç·´ç¿’ âœ¨' : `${state.selectedMultiplier} çš„ä¹˜æ³•ç·´ç¿’ âœ¨`;
    practiceContainer.innerHTML = `
      <h1 class="title" style="color:#9333ea; margin-bottom:10px">${title}</h1>
      <div class="score">å¾—åˆ†ï¼š<span>${state.score}</span> / 100</div>
      <div class="qcount">é¡Œç›® ${state.currentQuestionIndex+1} / 10</div>

      <div class="question-box">
        <p class="question">${state.currentQuestion.factor1} Ã— ${state.currentQuestion.factor2} = ?</p>
      </div>

      <div class="grid grid-choices mb-6" id="choices">
        ${state.options.map(v=>`<button class="btn btn-choice" data-val="${v}">${v}</button>`).join('')}
      </div>

      <p id="feedback" class="feedback" style="display:none"></p>
    `;

    const choices = document.getElementById('choices');
    const feedback = document.getElementById('feedback');

    choices.addEventListener('click', async (e)=>{
      const btn = e.target.closest('button[data-val]');
      if (!btn) return;
      if (state.selectedAnswer !== null) return; // already answered

      const selected = Number(btn.getAttribute('data-val'));
      state.selectedAnswer = selected;
      const correct = (selected === state.currentQuestion.answer);
      state.isCorrect = correct;

      // visual states
      const allBtns = [...choices.querySelectorAll('button[data-val]')];
      allBtns.forEach(b=>{
        const val = Number(b.getAttribute('data-val'));
        if (val === state.currentQuestion.answer){
          b.classList.add('correct'); // always show correct in GREEN
        } else if (val === selected && !correct){
          b.classList.add('wrong');
        } else {
          b.classList.add('dim');
        }
        b.disabled = true;
      });

      // sound + score + feedback
      if (correct){
        state.score += 10;
        feedback.textContent = 'âœ… ç­”å°äº†ï¼';
        await playCorrectSound();
      } else {
        feedback.textContent = `âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${state.currentQuestion.answer}`;
        await playIncorrectSound();
      }
      feedback.style.display = '';

      // save history
      state.history.push({
        question: `${state.currentQuestion.factor1} Ã— ${state.currentQuestion.factor2}`,
        correctAnswer: state.currentQuestion.answer,
        userAnswer: selected,
        isCorrect: correct
      });

      // next step
      setTimeout(()=>{
        if (state.currentQuestionIndex < 9){
          state.currentQuestionIndex += 1;
          generateQuestion(state.selectedMultiplier);
          renderQuiz();
        } else {
          state.showResult = true;
          renderResult();
        }
      }, 1500);
    });
  }

  function renderResult(){
    practiceContainer.innerHTML = `
      <h1 class="result-title">ç·´ç¿’çµæŸï¼ğŸ‰</h1>
      <p style="text-align:center; font-size:clamp(20px,3.2vw,28px); margin:8px 0 12px">ä½ çš„æœ€çµ‚å¾—åˆ†æ˜¯ï¼š</p>
      <div class="center"><span class="score-badge">${state.score} åˆ†</span></div>

      <h2 class="title" style="color:#2563eb; margin-top:12px; margin-bottom:12px">é¡Œç›®å›é¡§</h2>
      <div class="review">
        <table class="review-table" aria-label="å›é¡§è¡¨">
          <thead>
            <tr>
              <th>é¡Œç›®</th>
              <th>ä½ çš„ç­”æ¡ˆ</th>
              <th>æ­£ç¢ºç­”æ¡ˆ</th>
            </tr>
          </thead>
          <tbody>
            ${state.history.map(h => `
              <tr>
                <td style="font-weight:800">${h.question}</td>
                <td class="${h.isCorrect ? 'tag-ok' : 'tag-bad'}">${h.userAnswer}</td>
                <td style="font-weight:800; color:#374151">${h.correctAnswer}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>

      <div class="actions">
        <button id="btnRestart" class="btn-secondary">é‡æ–°é¸æ“‡ç·´ç¿’ ğŸ”„</button>
        <button id="btnReplay" class="btn-tertiary">${state.selectedMultiplier==='all' ? 'å†ç©ä¸€æ¬¡ç¶œåˆç·´ç¿’ï¼ğŸ²' : `å†ç©ä¸€æ¬¡ ${state.selectedMultiplier} çš„ä¹˜æ³•ï¼âœ¨`}</button>
      </div>
    `;

    document.getElementById('btnRestart').addEventListener('click', ()=>{
      state.selectedMultiplier = null;
      renderPracticeSelect();
    });

    document.getElementById('btnReplay').addEventListener('click', async ()=>{
      await initializeAudioContext();
      startRound();
      renderQuiz();
    });
  }

  // ----- Init -----
  buildMulTable();
})();
</script>
</body>
</html>













