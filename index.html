<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ååä¹˜æ³•è¡¨ & ä¹˜æ³•å¤§æŒ‘æˆ°ï½œHTML5</title>

<!-- Tone.js (for sound effects) -->
<script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>

<style>
  :root{
    --bg-grad1:#fde2e4; --bg-grad2:#dbeafe;
    --card:#ffffff; --muted:#6b7280; --text:#1f2937; --line:#e5e7eb;
    --purple-200:#e9d5ff; --purple-300:#d8b4fe; --purple-500:#a855f7;
    --green-200:#bbf7d0; --green-300:#86efac; --green-500:#22c55e;
    --indigo-200:#c7d2fe; --indigo-300:#a5b4fc; --indigo-400:#818cf8;
    --orange-200:#fed7aa; --orange-300:#fdba74; --orange-500:#f97316;
    --yellow-50:#fffbeb; --yellow-100:#fef3c7; --yellow-200:#fde68a;
    --yellow-300:#fcd34d; --yellow-800:#92400e;
    --blue-50:#eff6ff; --blue-100:#dbeafe; --blue-200:#bfdbfe; --blue-800:#1e40af;
    --teal-50:#f0fdfa; --teal-600:#0d9488;
    --red-500:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    color:var(--text);
    background: linear-gradient(135deg,var(--bg-grad1),var(--bg-grad2));
  }
  .wrap{min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:16px}
  nav{
    margin-bottom:24px; padding:16px; background:var(--card);
    border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.08);
    display:flex; flex-wrap:wrap; justify-content:center; gap:12px;
  }
  .pill{
    border:0; cursor:pointer; padding:12px 20px; border-radius:999px; font-weight:800; font-size:18px;
    transition:transform .2s ease, background-color .2s ease, box-shadow .2s ease, color .2s ease;
  }
  .pill:hover{transform:scale(1.05)}
  .pill-purple{background:var(--purple-200); color:#5b21b6}
  .pill-purple.active{background:var(--purple-500); color:#fff; box-shadow:0 6px 18px rgba(168,85,247,.35)}
  .pill-purple:hover{background:var(--purple-300)}
  .pill-green{background:var(--green-200); color:#065f46}
  .pill-green.active{background:var(--green-500); color:#fff; box-shadow:0 6px 18px rgba(34,197,94,.35)}
  .pill-green:hover{background:var(--green-300)}

  main{width:100%; max-width:1100px; padding:8px; transition:transform .5s ease}
  section.card{
    background:transparent; border-radius:20px;
  }
  h1.title{
    font-size:clamp(28px,4vw,44px); margin:0 0 20px; font-weight:900; text-align:center;
    color:#2563eb; text-shadow:0 3px 0 rgba(255,255,255,.4);
  }
  .subtitle{ text-align:center; color:var(--muted); margin-top:8px; }

  /* Learning table */
  .table-wrap{overflow-x:auto}
  table.mul{
    width:100%; border:1px solid var(--blue-200); border-collapse:separate; border-spacing:0; background:var(--blue-50);
    border-radius:14px; box-shadow:0 10px 30px rgba(30,64,175,.08);
    font-size:clamp(12px,2.3vw,18px);
  }
  .mul th,.mul td{ padding:6px 6px; border-bottom:1px solid var(--blue-200); text-align:center }
  .mul thead th{ background:var(--blue-200); color:var(--blue-800); font-weight:800 }
  .mul tbody td:first-child{
    background:#eaf2ff; color:#1d4ed8; font-weight:800; position:sticky; left:0;
  }
  .mul td.hl, .mul th.hl { background:var(--yellow-100) !important }
  .mul td.hl-strong, .mul th.hl-strong{ background:var(--yellow-300) !important }

  /* Practice */
  .center{text-align:center}
  .score{ font-size:clamp(18px,2.5vw,28px); font-weight:800; color:#065f46; margin-bottom:8px }
  .qcount{ font-size:clamp(16px,2.3vw,24px); color:#475569; margin-bottom:18px }

  .question-box{
    display:inline-block; background:var(--yellow-100); padding:24px; border-radius:22px; box-shadow:0 14px 36px rgba(0,0,0,.08);
    margin-bottom:20px; transform:scale(1.03);
  }
  .question{
    font-size:clamp(38px,6vw,62px); font-weight:900; color:var(--yellow-800); margin:0;
  }

  .grid{ display:grid; gap:12px; margin:0 auto }
  .grid-choices{ grid-template-columns: repeat(2, minmax(0,1fr)); max-width:560px }
  .grid-multipliers{ grid-template-columns: repeat(5, minmax(0,1fr)); max-width:720px }

  .btn{
    border:0; cursor:pointer; padding:14px 16px; border-radius:16px; font-weight:900;
    transition:transform .15s ease, box-shadow .2s ease, background-color .15s ease, color .15s ease;
    box-shadow:0 4px 14px rgba(0,0,0,.08); font-size:clamp(18px,3.2vw,28px)
  }
  .btn:hover{ transform:scale(1.05) }

  .btn-choice{ background:var(--indigo-300); color:#111827 }
  .btn-choice:hover{ background:var(--indigo-400) }
  .btn-choice.correct{ background:var(--green-500) !important; color:#fff !important; transform:scale(1.1); box-shadow:0 8px 24px rgba(34,197,94,.4) }
  .btn-choice.wrong{ background:var(--red-500) !important; color:#fff !important; transform:scale(1.05) }
  .btn-choice.dim{ opacity:.55; cursor:not-allowed; }

  .btn-multi{ background:var(--orange-200); color:#7c2d12; font-size:clamp(20px,3.5vw,30px) }
  .btn-multi.active{ background:var(--orange-500); color:#fff; box-shadow:0 6px 18px rgba(249,115,22,.35) }
  .btn-multi:hover{ background:var(--orange-300) }

  .btn-start{
    background:#3b82f6; color:#fff; padding:16px 26px; border-radius:999px; font-weight:900; font-size:clamp(20px,3.8vw,32px);
    box-shadow:0 10px 28px rgba(59,130,246,.35)
  }
  .btn-start:disabled{ background:#cbd5e1; color:#475569; cursor:not-allowed; box-shadow:none }

  .feedback{ font-size:clamp(20px,3.2vw,32px); font-weight:900; margin-top:10px; animation:bounce 1s infinite }

  @keyframes bounce{
    0%,100%{ transform:translateY(0) }
    50%{ transform:translateY(-6px) }
  }

  /* Result table */
  .result-title{
    font-size:clamp(28px,4vw,44px); font-weight:900; color:var(--teal-600); text-align:center; margin:0 0 16px;
    text-shadow:0 3px 0 rgba(255,255,255,.5)
  }
  .score-badge{
    display:inline-block; font-size:clamp(36px,6vw,56px); font-weight:900; color:var(--teal-600);
    background:var(--teal-50); padding:22px 28px; border-radius:999px; box-shadow:0 12px 28px rgba(13,148,136,.25);
    animation:bounce 1.1s infinite; margin-bottom:20px;
  }

  .review{
    background:var(--card); border-radius:16px; box-shadow:0 10px 24px rgba(0,0,0,.08);
    padding:14px 16px; overflow-x:auto; margin:0 auto; max-width:800px;
  }
  table.review-table{ width:100%; border-collapse:collapse; min-width:520px; font-size:clamp(14px,2.5vw,18px) }
  .review-table th,.review-table td{ padding:10px 12px; border-bottom:1px solid var(--line); text-align:left }
  .review-table thead th{ background:var(--blue-100); color:var(--blue-800) }
  .review-table tr:hover{ background:#f8fbff }
  .tag-ok{ color:var(--green-500); font-weight:800 }
  .tag-bad{ color:var(--red-500); font-weight:800 }

  .actions{ margin-top:16px; display:flex; flex-direction:column; gap:12px; align-items:center; justify-content:center }
  @media (min-width:720px){ .actions{ flex-direction:row } }

  .btn-secondary{
    background:var(--orange-500); color:#fff; border:0; padding:14px 22px; border-radius:999px; font-weight:900;
    font-size:clamp(18px,3.2vw,28px); transition:transform .15s ease; box-shadow:0 10px 26px rgba(249,115,22,.35)
  }
  .btn-secondary:hover{ transform:scale(1.05) }

  .btn-tertiary{
    background:var(--purple-500); color:#fff; border:0; padding:14px 22px; border-radius:999px; font-weight:900;
    font-size:clamp(18px,3.2vw,28px); transition:transform .15s ease; box-shadow:0 10px 26px rgba(168,85,247,.35)
  }
  .btn-tertiary:hover{ transform:scale(1.05) }

  /* helper spacers */
  .mb-6{ margin-bottom:24px }
</style>
</head>
<body>
<div class="wrap">
  <!-- Top Nav -->
  <nav>
    <button id="btnLearning" class="pill pill-purple active">ğŸ“š å­¸ç¿’ä¹˜æ³•</button>
    <button id="btnPractice" class="pill pill-green">ğŸ“ ç·´ç¿’æŒ‘æˆ°</button>
  </nav>

  <main>
    <!-- Learning Page -->
    <section id="learningPage" class="card">
      <h1 class="title">ååä¹˜æ³•è¡¨ ğŸ’–</h1>
      <div class="table-wrap">
        <table id="mulTable" class="mul" aria-label="10Ã—10 ä¹˜æ³•è¡¨"></table>
      </div>
      <p class="subtitle">é€™å€‹è¡¨æ ¼å¯ä»¥å¹«åŠ©ä½ å¿«é€Ÿå­¸ç¿’ä¹˜æ³•ï¼</p>
    </section>

    <!-- Practice Page -->
    <section id="practicePage" class="card" style="display:none">
      <div id="practiceContainer" class="center"></div>
    </section>
  </main>
</div>

<script>
(function(){
  // ----- State -----
  const state = {
    currentPage: 'learning',
    selectedMultiplier: null, // number or 'all'
    currentQuestionIndex: 0,  // 0..9
    currentQuestion: null,    // {factor1, factor2, answer}
    options: [],
    score: 0,
    roundStarted: false,
    showResult: false,
    selectedAnswer: null,
    isCorrect: null,
    history: []
  };

  // ----- Audio via Tone.js -----
  let synth = null;

  async function initializeAudioContext(){
    if (Tone.context.state !== 'running') {
      await Tone.start();
      // create synth after user gesture
      if (!synth) synth = new Tone.Synth().toDestination();
      console.log('AudioContext is initialized and running!');
    } else {
      if (!synth) synth = new Tone.Synth().toDestination();
    }
  }

  const delay = (ms) => new Promise(r => setTimeout(r, ms));

  async function playCorrectSound(){
    if (!synth || Tone.context.state !== 'running') return;
    synth.triggerAttackRelease("C5","8n");
    await delay(100);
    synth.triggerAttackRelease("G5","8n");
    await delay(200);
    synth.triggerAttackRelease("C5","8n");
    await delay(100);
    synth.triggerAttackRelease("G5","8n");
  }
  async function playIncorrectSound(){
    if (!synth || Tone.context.state !== 'running') return;
    synth.triggerAttackRelease("F4","8n");
    await delay(250);
    synth.triggerAttackRelease("C4","8n");
  }

  // ----- Page Switch -----
  const btnLearning = document.getElementById('btnLearning');
  const btnPractice = document.getElementById('btnPractice');
  const learningPage = document.getElementById('learningPage');
  const practicePage = document.getElementById('practicePage');

  btnLearning.addEventListener('click', async () => {
    await initializeAudioContext(); // optional: warm up on nav click
    state.currentPage = 'learning';
    learningPage.style.display = '';
    practicePage.style.display = 'none';
    btnLearning.classList.add('active');
    btnPractice.classList.remove('active');
  });

  btnPractice.addEventListener('click', async () => {
    await initializeAudioContext();
    state.currentPage = 'practice';
    learningPage.style.display = 'none';
    practicePage.style.display = '';
    btnPractice.classList.add('active');
    btnLearning.classList.remove('active');
    renderPracticeSelect();
  });

  // ----- Build Learning Table (10Ã—10) -----
  function buildMulTable(){
    const t = document.getElementById('mulTable');
    t.innerHTML = '';
    const thead = document.createElement('thead');
    const trh = document.createElement('tr');

    const thx = document.createElement('th');
    thx.textContent = 'Ã—';
    trh.appendChild(thx);

    for(let c=1;c<=10;c++){
      const th = document.createElement('th');
      th.textContent = c;
      trh.appendChild(th);
    }
    thead.appendChild(trh);
    t.appendChild(thead);

    const tbody = document.createElement('tbody');

    for(let r=1;r<=10;r++){
      const tr = document.createElement('tr');

      const thRow = document.createElement('td');
      thRow.textContent = r;
      thRow.style.fontWeight = '800';
      tr.appendChild(thRow);

      for(let c=1;c<=10;c++){
        const td = document.createElement('td');
        td.textContent = r*c;

        td.addEventListener('mouseenter', () => highlightRC(r,c));
        td.addEventListener('mouseleave', () => clearHighlight());

        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }
    t.appendChild(tbody);
  }

  function highlightRC(r,c){
    const t = document.getElementById('mulTable');
    clearHighlight();

    // header col
    t.tHead.rows[0].cells[c].classList.add('hl-strong');

    // rows
    for(let ri=0; ri<t.tBodies[0].rows.length; ri++){
      const row = t.tBodies[0].rows[ri];
      const rowIndex = ri+1;

      // row label cell
      if (rowIndex === r) row.cells[0].classList.add('hl-strong'); else row.cells[0].classList.remove('hl-strong');

      for(let ci=1; ci<row.cells.length; ci++){
        const cell = row.cells[ci];
        if (rowIndex === r || ci === c) {
          cell.classList.add('hl');
        }
        if (rowIndex === r && ci === c) {
          cell.classList.remove('hl');
          cell.classList.add('hl-strong');
        }
      }
    }
  }

  function clearHighlight(){
    document.querySelectorAll('#mulTable .hl, #mulTable .hl-strong').forEach(el => el.classList.remove('hl','hl-strong'));
  }

  // ----- Practice Flow -----
  const practiceContainer = document.getElementById('practiceContainer');

  function renderPracticeSelect(){
    state.roundStarted = false;
    state.showResult = false;
    practiceContainer.innerHTML = `
      <h1 class="title" style="color:#16a34a; text-shadow:0 3px 0 rgba(255,255,255,.4); margin-bottom:18px">ä¹˜æ³•å¤§æŒ‘æˆ° ğŸŒŸ</h1>

      <div class="grid grid-multipliers mb-6" id="multiGrid">
        <button class="btn btn-multi" data-val="all" style="grid-column:1/-1; font-size:clamp(22px,4vw,34px); padding:18px 0; border-radius:18px; background:#c7d2fe; color:#1e3a8a; box-shadow:0 8px 22px rgba(30,58,138,.25)">ğŸ² ç¶œåˆç·´ç¿’ (1~10)</button>
        ${Array.from({length:10},(_,i)=>i+1).map(n=>`<button class="btn btn-multi" data-val="${n}">${n}x</button>`).join('')}
      </div>

      <button id="btnStart" class="btn-start" disabled>é–‹å§‹ç·´ç¿’ï¼ğŸš€</button>
    `;

    const g = document.getElementById('multiGrid');
    const startBtn = document.getElementById('btnStart');

    g.addEventListener('click', (e)=>{
      const b = e.target.closest('button[data-val]');
      if (!b) return;
      g.querySelectorAll('button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const val = b.getAttribute('data-val');
      state.selectedMultiplier = (val==='all') ? 'all' : Number(val);
      startBtn.disabled = false;
    });

    startBtn.addEventListener('click', async ()=>{
      await initializeAudioContext();
      startRound();
      renderQuiz();
    });
  }

  function startRound(){
    state.score = 0;
    state.currentQuestionIndex = 0;
    state.roundStarted = true;
    state.showResult = false;
    state.history = [];
    generateQuestion(state.selectedMultiplier);
  }

  function generateQuestion(multiplier){
    let factor1, factor2;
    if (multiplier === 'all'){
      factor1 = Math.floor(Math.random()*10)+1;
      factor2 = Math.floor(Math.random()*10)+1;
    } else {
      factor1 = multiplier;
      factor2 = Math.floor(Math.random()*10)+1;
    }
    const answer = factor1 * factor2;

    const set = new Set([answer]);
    while(set.size < 4){
      const wrong = answer + (Math.floor(Math.random()*20) - 10);
      if (wrong > 0 && wrong !== answer) set.add(wrong);
    }
    const options = Array.from(set).sort(()=>Math.random()-0.5);

    state.currentQuestion = {factor1, factor2, answer};
    state.options = options;
    state.selectedAnswer = null;
    state.isCorrect = null;
  }

  function renderQuiz(){
    const title = (state.selectedMultiplier === 'all') ? 'ç¶œåˆä¹˜æ³•ç·´ç¿’ âœ¨' : `${state.selectedMultiplier} çš„ä¹˜æ³•ç·´ç¿’ âœ¨`;
    practiceContainer.innerHTML = `
      <h1 class="title" style="color:#9333ea; margin-bottom:10px">${title}</h1>
      <div class="score">å¾—åˆ†ï¼š<span>${state.score}</span> / 100</div>
      <div class="qcount">é¡Œç›® ${state.currentQuestionIndex+1} / 10</div>

      <div class="question-box">
        <p class="question">${state.currentQuestion.factor1} Ã— ${state.currentQuestion.factor2} = ?</p>
      </div>

      <div class="grid grid-choices mb-6" id="choices">
        ${state.options.map(v=>`<button class="btn btn-choice" data-val="${v}">${v}</button>`).join('')}
      </div>

      <p id="feedback" class="feedback" style="display:none"></p>
    `;

    const choices = document.getElementById('choices');
    const feedback = document.getElementById('feedback');

    choices.addEventListener('click', async (e)=>{
      const btn = e.target.closest('button[data-val]');
      if (!btn) return;
      if (state.selectedAnswer !== null) return; // already answered

      const selected = Number(btn.getAttribute('data-val'));
      state.selectedAnswer = selected;
      const correct = (selected === state.currentQuestion.answer);
      state.isCorrect = correct;

      // visual states
      const allBtns = [...choices.querySelectorAll('button[data-val]')];
      allBtns.forEach(b=>{
        const val = Number(b.getAttribute('data-val'));
        if (val === state.currentQuestion.answer){
          b.classList.add('correct'); // always show correct in GREEN
        } else if (val === selected && !correct){
          b.classList.add('wrong');
        } else {
          b.classList.add('dim');
        }
        b.disabled = true;
      });

      // sound + score + feedback
      if (correct){
        state.score += 10;
        feedback.textContent = 'âœ… ç­”å°äº†ï¼';
        await playCorrectSound();
      } else {
        feedback.textContent = `âŒ ç­”éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ ${state.currentQuestion.answer}`;
        await playIncorrectSound();
      }
      feedback.style.display = '';

      // save history
      state.history.push({
        question: `${state.currentQuestion.factor1} Ã— ${state.currentQuestion.factor2}`,
        correctAnswer: state.currentQuestion.answer,
        userAnswer: selected,
        isCorrect: correct
      });

      // next step
      setTimeout(()=>{
        if (state.currentQuestionIndex < 9){
          state.currentQuestionIndex += 1;
          generateQuestion(state.selectedMultiplier);
          renderQuiz();
        } else {
          state.showResult = true;
          renderResult();
        }
      }, 1500);
    });
  }

  function renderResult(){
    practiceContainer.innerHTML = `
      <h1 class="result-title">ç·´ç¿’çµæŸï¼ğŸ‰</h1>
      <p style="text-align:center; font-size:clamp(20px,3.2vw,28px); margin:8px 0 12px">ä½ çš„æœ€çµ‚å¾—åˆ†æ˜¯ï¼š</p>
      <div class="center"><span class="score-badge">${state.score} åˆ†</span></div>

      <h2 class="title" style="color:#2563eb; margin-top:12px; margin-bottom:12px">é¡Œç›®å›é¡§</h2>
      <div class="review">
        <table class="review-table" aria-label="å›é¡§è¡¨">
          <thead>
            <tr>
              <th>é¡Œç›®</th>
              <th>ä½ çš„ç­”æ¡ˆ</th>
              <th>æ­£ç¢ºç­”æ¡ˆ</th>
            </tr>
          </thead>
          <tbody>
            ${state.history.map(h => `
              <tr>
                <td style="font-weight:800">${h.question}</td>
                <td class="${h.isCorrect ? 'tag-ok' : 'tag-bad'}">${h.userAnswer}</td>
                <td style="font-weight:800; color:#374151">${h.correctAnswer}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>

      <div class="actions">
        <button id="btnRestart" class="btn-secondary">é‡æ–°é¸æ“‡ç·´ç¿’ ğŸ”„</button>
        <button id="btnReplay" class="btn-tertiary">${state.selectedMultiplier==='all' ? 'å†ç©ä¸€æ¬¡ç¶œåˆç·´ç¿’ï¼ğŸ²' : `å†ç©ä¸€æ¬¡ ${state.selectedMultiplier} çš„ä¹˜æ³•ï¼âœ¨`}</button>
      </div>
    `;

    document.getElementById('btnRestart').addEventListener('click', ()=>{
      state.selectedMultiplier = null;
      renderPracticeSelect();
    });

    document.getElementById('btnReplay').addEventListener('click', async ()=>{
      await initializeAudioContext();
      startRound();
      renderQuiz();
    });
  }

  // ----- Init -----
  buildMulTable();
})();
</script>
</body>
</html>
